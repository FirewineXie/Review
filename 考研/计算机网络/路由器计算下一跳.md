# 路由器计算下一跳



1. 设某路由器建立如下路由表：

   | 目的网络      | 子网掩码        | 下一跳 |
   | ------------- | --------------- | ------ |
   | 128.96.39.0   | 255.255.255.128 | 接口m0 |
   | 128.96.39.128 | 255.255.255.128 | 接口m1 |
   | 128.96.40.0   | 255.255.255.128 | R2     |
   | 192.4.153.0   | 255.255.255.192 | R3     |
   | *（默认）     | -               | R4     |

   现共收到5个分组，其目的站IP地址分别为：

   1. 128.96.39.10
   2. 128.96.40.12
   3. 128.96.40.151
   4. 192.4.153.17
   5. 192.4.153.90

## 首先分组转发的算法：

1. 从数据报的首部提取目的主机的==IP地址D==,得出==目的网络地址N==
2. 若n 就是此路由器==直接相连==的某个网络地址，则进行==直接交付==，不需要在经过其他的路由器，直接把数据报交付给目的主机（这里包括把目的主机地址D转换为具体的硬件地址，把数据报封装为MAC帧，在发送此帧）否则就是间接交付，执行（3）
3. 若路由表中有目的地址D 的特定主机路由，则把数据报传送路由表中所指明的下一跳路由器；否则执行（4）
4. 若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行（5）
5. 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则执行（6）
6. 报告分组转发错误

## 上题的解法

==路由表看的是网络地址，而现在的是IP地址，所以先得到此IP地址的网络地址==

128.96.39.10 与 两个子网掩码  = 128.96.39.0   

128.96.40.12 与 两个子网掩码  = 128.96.40.0 

128.96.40.151与 两个子网掩码  = 128.96.40.128 

192.4.153.17与 两个子网掩码  = 192.4.153.0 

192.4.153.90与 两个子网掩码  = 192.4.153.64

则答案为==1. 接口0,2. R2，3. R4，4. R3 5. R4